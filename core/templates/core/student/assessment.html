{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Write Assessment: {{ assessment.eisa_id }}</title>

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        /* ───────────────────────────────────────────────
           COLOUR PALETTE & TOKENS
        ─────────────────────────────────────────────── */
        :root {
            --chi-purple-900: #320846;
            --chi-purple-700: #552a74;
            --chi-purple-500: #734e94;
            --chi-gold-600:   #a67c00;
            --chi-grey-050:  #ecf0f1;
        }

        body {
            font-family: Georgia, "Times New Roman", Times, serif;
            background: var(--chi-grey-050);
        }

        /* ───────────────────────────────────────────────
           LAYOUT HELPERS
        ─────────────────────────────────────────────── */
        .timer-wrap { max-width: 600px; margin-inline: auto; }

        /* ───────────────────────────────────────────────
           TIMER BAR
        ─────────────────────────────────────────────── */
        .time-track {
            background: #f0f0f0;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        .time-progress {
            height: 100%;
            width: 100%;
            background: linear-gradient(to right, #4facfe, #00f2fe);
            transition: width 1s linear;
        }
        .time-warning { background: linear-gradient(to right, #ff416c, #ff4b2b) !important; }
        .time-expired { background: #ff0000 !important; }

        /* ───────────────────────────────────────────────
           QUESTION CARD
        ─────────────────────────────────────────────── */
        .question-card { border-left: 4px solid var(--chi-purple-900); }

        /* ───────────────────────────────────────────────
           BUTTONS
        ─────────────────────────────────────────────── */
        .btn-chi {
            background: linear-gradient(to right, var(--chi-purple-900), var(--chi-purple-700), var(--chi-purple-500));
            color: #fff;
            border: none;
        }
        .btn-chi:hover { opacity: .93; }

        /* ───────────────────────────────────────────────
           INTRO CARD
        ─────────────────────────────────────────────── */
        #introScreen {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,.08);
            max-width: 820px;
            margin: 2.5rem auto;
        }
        .alert-info ul { padding-left: 1.2rem; }
    </style>
</head>
<body>
    <!-- ─────────────  INTRO  ───────────── -->
    <div id="introScreen" class="card">
        <div class="card-body text-center">
            <h2 class="mb-4">You Are About To Write An Exam</h2>
            <div class="alert alert-info text-start mx-auto" style="max-width:600px;">
                <strong>Instructions:</strong>
                <ul class="mb-0 mt-2">
                    <li>You have <strong>10&nbsp;minutes</strong> to complete the paper.</li>
                    <li>The timer starts when you click <em>Begin&nbsp;Exam</em>.</li>
                    <li>Do <u>not</u> refresh or leave the page.</li>
                    <li>The form auto‑submits when time is up.</li>
                </ul>
            </div>
            <button id="startExamBtn" class="btn btn-chi px-4">Begin&nbsp;Exam</button>
        </div>
    </div>

    <!-- ─────────────  EXAM CONTENT  ───────────── -->
    <div id="examContent" class="container mt-4 d-none">
        <h2 class="mb-3">Exam&nbsp;Paper: {{ assessment.eisa_id }}</h2>

        <!-- TIMER BAR -->
        <div class="timer-wrap mb-4">
            <div class="d-flex justify-content-between mb-1 small">
                <span>TIME&nbsp;REMAINING:</span>
                <span id="timeDisplay" class="fw-bold">10:00</span>
            </div>
            <div class="time-track">
                <div id="timeProgress" class="time-progress"></div>
            </div>
        </div>

        {% if assessment.id %}
        <form id="demoForm" method="post" action="{% url 'submit_exam' assessment_id=assessment.id %}">
            {% csrf_token %}

            {% for question in assessment.generated_questions.all %}
            <div class="question-card card mb-3">
                <div class="card-body">
                    <h5 class="card-title mb-2">Question {{ forloop.counter }}</h5>
                    <p class="card-text">{{ question.text }}</p>
                    <textarea name="answer_{{ question.id }}" rows="3" class="form-control" required></textarea>
                </div>
            </div>
            {% endfor %}

            <div class="text-center">
                <button class="btn btn-success px-5">Submit&nbsp;All&nbsp;Answers</button>
            </div>
        </form>
        {% else %}
            <div class="alert alert-danger">Error: Assessment&nbsp;ID missing – cannot submit.</div>
        {% endif %}
    </div>

    <!-- ─────────────  SCRIPTS  ───────────── -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const intro  = document.getElementById("introScreen");
        const exam   = document.getElementById("examContent");
        const start  = document.getElementById("startExamBtn");
        const bar    = document.getElementById("timeProgress");
        const label  = document.getElementById("timeDisplay");
        const form   = document.getElementById("demoForm");

        const TOTAL  = 10 * 60; // seconds
        let   remain = TOTAL;
        let   tick   = null;

        function updateUI() {
            const m = Math.floor(remain / 60);
            const s = remain % 60;
            label.textContent = `${m}:${s.toString().padStart(2,'0')}`;
            bar.style.width = `${(remain / TOTAL) * 100}%`;
            if (remain === 60) bar.classList.add("time-warning");
            if (remain <= 0)   finish();
        }

        function finish() {
            clearInterval(tick);
            bar.classList.replace("time-warning", "time-expired");
            label.textContent = "00:00";
            form.submit();
        }

        start?.addEventListener("click", () => {
            intro.classList.add("d-none");
            exam.classList.remove("d-none");
            updateUI();
            tick = setInterval(() => { remain--; updateUI(); }, 1000);
        });
    });
    </script>
</body>
</html>

