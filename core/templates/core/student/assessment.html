<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Assessment System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #3C1B50;
            --secondary-color: #8f6620;
            --correct-color: #4CAF50;
            --incorrect-color: #F44336;
            --warning-color: #FF9800;
            --light-gray: #f5f5f5;
            --medium-gray: #e0e0e0;
            --dark-gray: #333333;
            --text-light: #666666;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9f9f9;
            color: var(--dark-gray);
        }
        
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .dashboard-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .dashboard-title {
            font-size: 36px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .dashboard-subtitle {
            color: var(--text-light);
            font-size: 18px;
        }
        
        .exam-card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .exam-card {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .exam-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .exam-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--medium-gray);
        }
        
        .exam-card-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .exam-card-difficulty {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .difficulty-easy {
            background-color: rgba(76, 175, 80, 0.2);
            color: #2E7D32;
        }
        
        .difficulty-medium {
            background-color: rgba(255, 152, 0, 0.2);
            color: #E65100;
        }
        
        .difficulty-hard {
            background-color: rgba(244, 67, 54, 0.2);
            color: #C62828;
        }
        
        .exam-card-body {
            margin-bottom: 20px;
        }
        
        .exam-card-description {
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .exam-card-meta {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text-light);
        }
        
        .exam-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .exam-card-btn {
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            background-color: var(--primary-color);
            color: white;
        }
        
        .exam-card-btn:hover {
            background-color: #2a1238;
        }
        
        /* Exam Container Styles */
        .exam-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: none;
        }
        
        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .exam-title {
            font-size: 24px;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .timer-container {
            display: flex;
            align-items: center;
            background-color: var(--light-gray);
            padding: 10px 15px;
            border-radius: 30px;
            font-weight: 600;
        }
        
        .timer-icon {
            margin-right: 8px;
            color: var(--warning-color);
        }
        
        .timer {
            color: var(--primary-color);
        }
        
        .warning {
            color: var(--warning-color);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .exam-body {
            display: flex;
            gap: 20px;
        }
        
        .question-navigation {
            width: 250px;
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            height: fit-content;
        }
        
        .nav-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .question-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }
        
        .question-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--light-gray);
            border: 1px solid var(--medium-gray);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .question-btn:hover {
            background-color: var(--medium-gray);
        }
        
        .question-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .question-btn.answered {
            background-color: var(--correct-color);
            color: white;
            border-color: var(--correct-color);
        }
        
        .question-btn.marked {
            position: relative;
        }
        
        .question-btn.marked::after {
            content: "!";
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--warning-color);
            color: white;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .question-content {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--medium-gray);
        }
        
        .question-number {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .question-type {
            background-color: var(--light-gray);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .question-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        /* Multiple Choice Options */
        .options-list {
            list-style: none;
            margin-bottom: 20px;
        }
        
        .option-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            background-color: var(--light-gray);
            border-radius: 6px;
            border: 1px solid var(--medium-gray);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option-item:hover {
            background-color: #e9e9e9;
        }
        
        .option-item.selected {
            border-color: var(--primary-color);
            background-color: rgba(60, 27, 80, 0.1);
        }
        
        /* True/False Options */
        .true-false-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .true-false-btn {
            flex: 1;
            padding: 15px;
            text-align: center;
            border: 2px solid var(--medium-gray);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .true-false-btn:hover {
            background-color: #e9e9e9;
        }
        
        .true-false-btn.selected {
            border-color: var(--primary-color);
            background-color: rgba(60, 27, 80, 0.1);
        }
        
        /* Matching Questions */
        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .matching-column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .matching-item {
            padding: 12px;
            background-color: var(--light-gray);
            border: 1px solid var(--medium-gray);
            border-radius: 6px;
            cursor: move;
            text-align: center;
        }
        
        .matched-pair {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .matched-item {
            padding: 10px;
            background-color: var(--light-gray);
            border-radius: 6px;
            flex: 1;
            text-align: center;
        }
        
        .match-controls {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .match-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
        }
        
        /* Fill in the Blank */
        .fill-blank-container {
            margin-bottom: 20px;
        }
        
        .fill-blank-input {
            padding: 8px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
            margin: 0 5px;
            width: 200px;
        }
        
        /* Essay Questions */
        .essay-container {
            margin-bottom: 20px;
        }
        
        .essay-textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid var(--medium-gray);
            border-radius: 6px;
            resize: vertical;
            font-family: inherit;
        }
        
        .word-count {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 5px;
            text-align: right;
        }
        
        /* Case Study */
        .case-study-container {
            background-color: var(--light-gray);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .case-study-text {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        /* Chart Questions - Made smaller */
        .chart-container {
            margin: 15px 0;
            max-width: 350px;
            max-height: 250px;
        }
        
        .chart-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .chart-box {
            flex: 1;
            min-width: 250px;
            height: 200px;
        }
        
        /* Matched pairs container */
        .matched-pairs-container {
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid var(--medium-gray);
            border-radius: 6px;
            padding: 5px;
        }
        
        /* Question Navigation */
        .question-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--medium-gray);
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
        }
        
        .btn-outline {
            background: white;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-outline:hover {
            background-color: rgba(60, 27, 80, 0.1);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2a1238;
        }
        
        .mark-btn {
            background-color: var(--warning-color);
            color: white;
        }
        
        .mark-btn:hover {
            background-color: #e68a00;
        }
        
        .submit-btn {
            background-color: var(--correct-color);
            color: white;
        }
        
        .submit-btn:hover {
            background-color: #3d8b40;
        }
        
        /* Exam Rules Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-container {
            background-color: white;
            border-radius: 8px;
            width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: modalFadeIn 0.3s;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .rules-list {
            list-style-type: none;
            margin-bottom: 20px;
        }
        
        .rules-list li {
            padding: 10px 0;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            align-items: flex-start;
        }
        
        .rules-list li i {
            margin-right: 10px;
            color: var(--secondary-color);
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--medium-gray);
            text-align: right;
        }
        
        /* Result chart container */
        .result-chart-container {
            max-width: 300px;
            max-height: 200px;
            margin: 0 auto 20px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 992px) {
            .exam-body {
                flex-direction: column;
            }
            
            .question-navigation {
                width: 100%;
                order: 2;
                margin-top: 20px;
            }
            
            .exam-card-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .matching-container {
                grid-template-columns: 1fr;
            }
            
            .question-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .chart-box {
                min-width: 100%;
            }
        }
        
        @media (max-width: 576px) {
            .exam-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .timer-container {
                margin-top: 10px;
            }
            
            .question-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .true-false-options {
                flex-direction: column;
            }
            
            .matched-pair {
                flex-direction: column;
            }
            
            .dashboard-title {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <!-- Dashboard View -->
    <div class="dashboard-container" id="dashboard-view">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Online Assesment System</h1>
            <p class="dashboard-subtitle">Test your knowledge and earn certifications</p>
        </div>
        
        <div class="exam-card-container">
            <div class="exam-card">
                <div class="exam-card-header">
                    <h2 class="exam-card-title">Chemical Engineering Certification</h2>
                    <span class="exam-card-difficulty difficulty-medium">Medium</span>
                </div>
                <div class="exam-card-body">
                    <p class="exam-card-description">
                        This certification exam covers fundamental principles of chemical engineering including thermodynamics, 
                        fluid mechanics, and process design. The exam consists of 30 questions with a 3-hour time limit.
                    </p>
                    <div class="exam-card-meta">
                        <span><i class="far fa-clock"></i> 3 hours</span>
                        <span><i class="far fa-question-circle"></i> 30 questions</span>
                    </div>
                </div>
                <div class="exam-card-footer">
                    <span><i class="fas fa-award"></i> Professional Certification</span>
                    <button class="exam-card-btn" onclick="showExam('chemical-engineering')">
                        Take Exam
                    </button>
                </div>
            </div>
            
            <div class="exam-card">
                <div class="exam-card-header">
                    <h2 class="exam-card-title">Process Safety Fundamentals</h2>
                    <span class="exam-card-difficulty difficulty-hard">Hard</span>
                </div>
                <div class="exam-card-body">
                    <p class="exam-card-description">
                        Test your knowledge of process safety management, hazard analysis, and risk assessment techniques 
                        used in chemical process industries.
                    </p>
                    <div class="exam-card-meta">
                        <span><i class="far fa-clock"></i> 2.5 hours</span>
                        <span><i class="far fa-question-circle"></i> 25 questions</span>
                    </div>
                </div>
                <div class="exam-card-footer">
                    <span><i class="fas fa-shield-alt"></i> Safety Certification</span>
                    <button class="exam-card-btn" onclick="showExam('process-safety')">
                        Take Exam
                    </button>
                </div>
            </div>
            
            <div class="exam-card">
                <div class="exam-card-header">
                    <h2 class="exam-card-title">Petroleum Refining Basics</h2>
                    <span class="exam-card-difficulty difficulty-easy">Easy</span>
                </div>
                <div class="exam-card-body">
                    <p class="exam-card-description">
                        Introductory exam covering the basic processes and equipment used in petroleum refining operations 
                        and petrochemical production.
                    </p>
                    <div class="exam-card-meta">
                        <span><i class="far fa-clock"></i> 1.5 hours</span>
                        <span><i class="far fa-question-circle"></i> 20 questions</span>
                    </div>
                </div>
                <div class="exam-card-footer">
                    <span><i class="fas fa-gas-pump"></i> Industry Certification</span>
                    <button class="exam-card-btn" onclick="showExam('petroleum-refining')">
                        Take Exam
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Exam View -->
    <div class="exam-container" id="exam-view">
        <!-- Exam Header with Timer -->
        <div class="exam-header">
            <div class="exam-title" id="exam-title">Chemical Engineering Certification Exam</div>
            <div class="timer-container">
                <i class="fas fa-clock timer-icon"></i>
                <div class="timer" id="exam-timer">03:00:00</div>
            </div>
        </div>
        
        <!-- Exam Body -->
        <div class="exam-body">
            <!-- Question Navigation Panel -->
            <div class="question-navigation">
                <div class="nav-title">
                    <span>Questions</span>
                    <span id="answered-count">0/30</span>
                </div>
                <div class="question-grid" id="question-grid">
                    <!-- Questions will be added dynamically -->
                </div>
                <button class="btn btn-outline" style="width: 100%; margin-top: 15px;" onclick="returnToDashboard()">
                    <i class="fas fa-arrow-left"></i> Return to Dashboard
                </button>
            </div>
            
            <!-- Question Content -->
            <div class="question-content" id="question-content">
                <!-- Question will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Exam Rules Modal -->
    <div class="modal-overlay" id="rules-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">Assesment Rules and Instructions</div>
                <button class="modal-close" onclick="startExam()">&times;</button>
            </div>
            <div class="modal-body">
                <h3 style="margin-bottom: 15px; color: var(--primary-color);">Please read the following instructions carefully:</h3>
                
                <ul class="rules-list">
                    <li>
                        <i class="fas fa-clock"></i>
                        <div>
                            <strong>Time Allocation:</strong> You have 3 hours to complete this exam. The timer will start when you begin the exam.
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-question-circle"></i>
                        <div>
                            <strong>Question Navigation:</strong> You can attempt questions in any order. Use the question navigation panel to jump between questions.
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-flag"></i>
                        <div>
                            <strong>Marking Questions:</strong> You can mark questions for review and come back to them later.
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong>Answering Questions:</strong> For multiple choice questions, select one answer. For matching questions, drag and drop items to match them.
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-chart-pie"></i>
                        <div>
                            <strong>Chart Questions:</strong> Some questions may require you to interpret data from various chart types (radar, pie, line, etc.).
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-pen-fancy"></i>
                        <div>
                            <strong>Essay Questions:</strong> For essay questions, provide a detailed response in the text box provided.
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-book"></i>
                        <div>
                            <strong>Case Studies:</strong> Some questions are based on case studies. Read the case carefully before answering.
                        </div>
                    </li>
                    <li>
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>Auto-Submission:</strong> The exam will automatically submit when time expires, so make sure to complete all questions before time runs out.
                        </div>
                    </li>
                </ul>
                
                <div style="background-color: rgba(143, 102, 32, 0.1); padding: 15px; border-radius: 6px; border-left: 4px solid var(--secondary-color);">
                    <h4 style="color: var(--secondary-color); margin-bottom: 10px;">Important Note:</h4>
                    <p>Once you start the exam, you cannot pause the timer. All answers are final after submission. Good luck!</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="startExam()">I Understand - Start Exam</button>
            </div>
        </div>
    </div>
    
    <script>
        // Exam data with various question types (30 questions)
        const exams = {
            'chemical-engineering': {
                title: "Chemical Engineering Certification Exam",
                duration: 180, // in minutes
                questions: createChemicalEngineeringExam()
            },
            'process-safety': {
                title: "Process Safety Fundamentals Exam",
                duration: 150,
                questions: createProcessSafetyExam()
            },
            'petroleum-refining': {
                title: "Petroleum Refining Basics Exam",
                duration: 90,
                questions: createPetroleumRefiningExam()
            }
        };
        
        function createChemicalEngineeringExam() {
            return [
                {
                    id: 1,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a fundamental principle of chemical engineering?",
                    options: [
                        "Conservation of mass",
                        "Conservation of energy",
                        "Conservation of momentum",
                        "Conservation of electrical charge"
                    ],
                    correctAnswer: 3
                },
                {
                    id: 2,
                    type: "true-false",
                    question: "The Reynolds number is used to determine whether a flow is laminar or turbulent.",
                    correctAnswer: true
                },
                {
                    id: 3,
                    type: "matching",
                    question: "Match the following unit operations to their primary purpose:",
                    leftItems: ["Distillation", "Filtration", "Crystallization", "Absorption"],
                    rightItems: [
                        "Separate components based on boiling points",
                        "Separate solids from liquids",
                        "Form solid particles from solution",
                        "Remove components from gas streams"
                    ],
                    correctMatches: [[0,0], [1,1], [2,2], [3,3]]
                },
                {
                    id: 4,
                    type: "fill-blank",
                    question: "The __________ law states that the rate of a chemical reaction is proportional to the product of the concentrations of the reactants.",
                    correctAnswer: "rate"
                },
                {
                    id: 5,
                    type: "essay",
                    question: "Explain the importance of process safety management in chemical plants. Provide at least three key elements of an effective safety program.",
                    minWords: 100
                },
                {
                    id: 6,
                    type: "case-study",
                    question: "Based on the case study below, what was the root cause of the reactor temperature runaway?",
                    caseText: "A batch reactor experienced a temperature runaway during the production of specialty chemicals. The investigation revealed that the cooling system was operating at reduced capacity due to a partially closed valve, and the temperature controller was set to manual mode. Operators failed to notice the rising temperature until alarms sounded.",
                    options: [
                        "Inadequate cooling capacity",
                        "Operator error",
                        "Faulty temperature sensor",
                        "All of the above"
                    ],
                    correctAnswer: 1
                },
                {
                    id: 7,
                    type: "chart-radar",
                    question: "Based on the radar chart below showing catalyst performance data, which catalyst has the best overall performance considering all parameters?",
                    chartData: {
                        labels: ['Activity', 'Selectivity', 'Stability', 'Cost', 'Ease of Use'],
                        datasets: [
                            {
                                label: 'Catalyst A',
                                data: [80, 70, 90, 60, 85],
                                backgroundColor: 'rgba(60, 27, 80, 0.2)',
                                borderColor: 'rgba(60, 27, 80, 1)',
                                pointBackgroundColor: 'rgba(60, 27, 80, 1)',
                                pointBorderColor: '#fff'
                            },
                            {
                                label: 'Catalyst B',
                                data: [90, 85, 80, 70, 75],
                                backgroundColor: 'rgba(143, 102, 32, 0.2)',
                                borderColor: 'rgba(143, 102, 32, 1)',
                                pointBackgroundColor: 'rgba(143, 102, 32, 1)',
                                pointBorderColor: '#fff'
                            },
                            {
                                label: 'Catalyst C',
                                data: [70, 90, 85, 80, 70],
                                backgroundColor: 'rgba(76, 175, 80, 0.2)',
                                borderColor: 'rgba(76, 175, 80, 1)',
                                pointBackgroundColor: 'rgba(76, 175, 80, 1)',
                                pointBorderColor: '#fff'
                            }
                        ]
                    },
                    correctAnswer: 1 // Catalyst B
                },
                {
                    id: 8,
                    type: "chart-pie",
                    question: "Based on the pie chart below showing raw material costs, which material accounts for approximately 25% of total costs?",
                    chartData: {
                        labels: ['Material A', 'Material B', 'Material C', 'Material D'],
                        datasets: [{
                            data: [15, 25, 35, 25],
                            backgroundColor: [
                                'rgba(60, 27, 80, 0.7)',
                                'rgba(143, 102, 32, 0.7)',
                                'rgba(76, 175, 80, 0.7)',
                                'rgba(244, 67, 54, 0.7)'
                            ]
                        }]
                    },
                    correctAnswer: 1 // Material B
                },
                {
                    id: 9,
                    type: "chart-line",
                    question: "Based on the line chart showing production rates over time, during which month did the production rate peak?",
                    chartData: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Production Rate (tons/day)',
                            data: [120, 135, 150, 145, 165, 160],
                            borderColor: 'rgba(60, 27, 80, 1)',
                            backgroundColor: 'rgba(60, 27, 80, 0.1)',
                            fill: true
                        }]
                    },
                    correctAnswer: 4 // May
                },
                {
                    id: 10,
                    type: "chart-bar",
                    question: "Based on the bar chart showing energy consumption by department, which department has the highest energy consumption?",
                    chartData: {
                        labels: ['Reactor', 'Distillation', 'Utilities', 'Packaging'],
                        datasets: [{
                            label: 'Energy Consumption (kWh)',
                            data: [25000, 18000, 30000, 12000],
                            backgroundColor: [
                                'rgba(60, 27, 80, 0.7)',
                                'rgba(143, 102, 32, 0.7)',
                                'rgba(76, 175, 80, 0.7)',
                                'rgba(244, 67, 54, 0.7)'
                            ]
                        }]
                    },
                    correctAnswer: 2 // Utilities
                },
                {
                    id: 11,
                    type: "chart-doughnut",
                    question: "Based on the doughnut chart showing waste composition, which material makes up the largest portion of waste?",
                    chartData: {
                        labels: ['Plastic', 'Metal', 'Glass', 'Organic'],
                        datasets: [{
                            data: [15, 10, 5, 70],
                            backgroundColor: [
                                'rgba(60, 27, 80, 0.7)',
                                'rgba(143, 102, 32, 0.7)',
                                'rgba(76, 175, 80, 0.7)',
                                'rgba(244, 67, 54, 0.7)'
                            ]
                        }]
                    },
                    correctAnswer: 3 // Organic
                },
                {
                    id: 12,
                    type: "chart-polar",
                    question: "Based on the polar area chart showing catalyst properties, which catalyst has the highest selectivity?",
                    chartData: {
                        labels: ['Catalyst A', 'Catalyst B', 'Catalyst C', 'Catalyst D'],
                        datasets: [{
                            label: 'Selectivity',
                            data: [65, 80, 72, 90],
                            backgroundColor: [
                                'rgba(60, 27, 80, 0.5)',
                                'rgba(143, 102, 32, 0.5)',
                                'rgba(76, 175, 80, 0.5)',
                                'rgba(244, 67, 54, 0.5)'
                            ],
                            borderColor: [
                                'rgba(60, 27, 80, 1)',
                                'rgba(143, 102, 32, 1)',
                                'rgba(76, 175, 80, 1)',
                                'rgba(244, 67, 54, 1)'
                            ]
                        }]
                    },
                    correctAnswer: 3 // Catalyst D
                },
                {
                    id: 13,
                    type: "calculation",
                    question: "Calculate the pressure drop (in Pa) for a fluid flowing through a 10m long pipe with a diameter of 0.1m, a flow rate of 0.05 m³/s, and a friction factor of 0.02. The fluid density is 1000 kg/m³.",
                    correctAnswer: "64000"
                },
                {
                    id: 14,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a typical responsibility of a chemical engineer?",
                    options: [
                        "Designing chemical processes",
                        "Developing new materials",
                        "Performing financial audits",
                        "Optimizing production efficiency"
                    ],
                    correctAnswer: 2
                },
                {
                    id: 15,
                    type: "true-false",
                    question: "The second law of thermodynamics states that energy cannot be created or destroyed, only converted from one form to another.",
                    correctAnswer: false
                },
                {
                    id: 16,
                    type: "essay",
                    question: "Describe the concept of 'green chemistry' and provide three examples of how it can be implemented in chemical manufacturing processes.",
                    minWords: 120
                },
                {
                    id: 17,
                    type: "case-study",
                    question: "Based on the case study below, what would be the most appropriate action to prevent similar incidents in the future?",
                    caseText: "A chemical plant experienced a release of toxic gas due to a rupture in a storage tank. The investigation found that the tank was corroded and hadn't been inspected in 5 years, despite company policy requiring annual inspections. The corrosion was visible but wasn't reported by operators.",
                    options: [
                        "Replace all storage tanks immediately",
                        "Implement a more rigorous inspection and reporting system",
                        "Retrain operators on hazard recognition",
                        "All of the above"
                    ],
                    correctAnswer: 3
                },
                {
                    id: 18,
                    type: "chart-radar",
                    question: "Based on the radar chart comparing two separation processes, which process has better energy efficiency but worse product purity?",
                    chartData: {
                        labels: ['Energy Efficiency', 'Product Purity', 'Capital Cost', 'Operating Cost', 'Flexibility'],
                        datasets: [
                            {
                                label: 'Process A',
                                data: [80, 90, 70, 65, 75],
                                backgroundColor: 'rgba(60, 27, 80, 0.2)',
                                borderColor: 'rgba(60, 27, 80, 1)'
                            },
                            {
                                label: 'Process B',
                                data: [90, 80, 60, 70, 80],
                                backgroundColor: 'rgba(143, 102, 32, 0.2)',
                                borderColor: 'rgba(143, 102, 32, 1)'
                            }
                        ]
                    },
                    correctAnswer: 1 // Process B
                },
                {
                    id: 19,
                    type: "matching",
                    question: "Match the following process variables with their typical units of measurement:",
                    leftItems: ["Flow rate", "Pressure", "Temperature", "Concentration"],
                    rightItems: [
                        "kg/s or m³/h",
                        "Pa or bar",
                        "°C or K",
                        "mol/m³ or %"
                    ],
                    correctMatches: [[0,0], [1,1], [2,2], [3,3]]
                },
                {
                    id: 20,
                    type: "fill-blank",
                    question: "The __________ number is a dimensionless quantity used to characterize fluid flow regimes in pipes and conduits.",
                    correctAnswer: "Reynolds"
                },
                {
                    id: 21,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a common type of heat exchanger used in chemical plants?",
                    options: [
                        "Shell-and-tube",
                        "Plate",
                        "Spiral",
                        "Rotary drum"
                    ],
                    correctAnswer: 3
                },
                {
                    id: 22,
                    type: "true-false",
                    question: "A packed bed reactor typically has better heat transfer characteristics than a stirred tank reactor.",
                    correctAnswer: false
                },
                {
                    id: 23,
                    type: "chart-line",
                    question: "Based on the line chart showing reactor temperature over time, at what time did the temperature first exceed 200°C?",
                    chartData: {
                        labels: ['08:00', '10:00', '12:00', '14:00', '16:00'],
                        datasets: [{
                            label: 'Temperature (°C)',
                            data: [180, 195, 210, 205, 220],
                            borderColor: 'rgba(244, 67, 54, 1)',
                            backgroundColor: 'rgba(244, 67, 54, 0.1)'
                        }]
                    },
                    correctAnswer: 2 // 12:00
                },
                {
                    id: 24,
                    type: "essay",
                    question: "Explain the concept of 'process intensification' in chemical engineering and provide two examples of how it can be achieved.",
                    minWords: 80
                },
                {
                    id: 25,
                    type: "case-study",
                    question: "Based on the case study below, what was the most likely cause of the product quality issue?",
                    caseText: "A batch chemical process was producing product that consistently failed purity specifications. Investigation revealed that the reaction temperature was 5°C lower than specified, the catalyst concentration was 10% higher than recommended, and the mixing time was 20% shorter than standard.",
                    options: [
                        "Low reaction temperature",
                        "High catalyst concentration",
                        "Short mixing time",
                        "Combination of all factors"
                    ],
                    correctAnswer: 3
                },
                {
                    id: 26,
                    type: "chart-bar",
                    question: "Based on the stacked bar chart showing raw material usage by product, which product uses the highest percentage of Material B?",
                    chartData: {
                        labels: ['Product X', 'Product Y', 'Product Z'],
                        datasets: [
                            {
                                label: 'Material A',
                                data: [30, 40, 20],
                                backgroundColor: 'rgba(60, 27, 80, 0.7)'
                            },
                            {
                                label: 'Material B',
                                data: [20, 10, 30],
                                backgroundColor: 'rgba(143, 102, 32, 0.7)'
                            },
                            {
                                label: 'Material C',
                                data: [50, 50, 50],
                                backgroundColor: 'rgba(76, 175, 80, 0.7)'
                            }
                        ]
                    },
                    correctAnswer: 2 // Product Z
                },
                {
                    id: 27,
                    type: "calculation",
                    question: "Calculate the heat required (in kJ) to raise the temperature of 5 kg of water from 20°C to 80°C. The specific heat capacity of water is 4.18 kJ/kg·K.",
                    correctAnswer: "1254"
                },
                {
                    id: 28,
                    type: "multiple-choice",
                    question: "Which of the following is NOT a common method for particle size analysis?",
                    options: [
                        "Sieve analysis",
                        "Laser diffraction",
                        "Gas adsorption",
                        "Sedimentation"
                    ],
                    correctAnswer: 2
                },
                {
                    id: 29,
                    type: "true-false",
                    question: "A higher Damköhler number indicates that mass transfer limitations are more significant than reaction kinetics.",
                    correctAnswer: false
                },
                {
                    id: 30,
                    type: "chart-polar",
                    question: "Based on the polar chart showing process performance metrics, which metric is most in need of improvement?",
                    chartData: {
                        labels: ['Yield', 'Purity', 'Energy Use', 'Throughput', 'Safety'],
                        datasets: [{
                            label: 'Performance',
                            data: [85, 90, 65, 80, 95],
                            backgroundColor: 'rgba(60, 27, 80, 0.5)'
                        }]
                    },
                    correctAnswer: 2 // Energy Use
                }
            ];
        }
        
        function createProcessSafetyExam() {
            // Similar structure with process safety questions
            // ...
            return [];
        }
        
        function createPetroleumRefiningExam() {
            // Similar structure with petroleum refining questions
            // ...
            return [];
        }
        
        // Current exam state
        let currentExam = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let markedQuestions = [];
        let answeredCount = 0;
        let examStarted = false;
        let timeLeft = 0;
        let timerInterval;
        let charts = [];
        
        // DOM elements
        const dashboardView = document.getElementById('dashboard-view');
        const examView = document.getElementById('exam-view');
        const questionContent = document.getElementById('question-content');
        const questionGrid = document.getElementById('question-grid');
        const answeredCountEl = document.getElementById('answered-count');
        const examTimer = document.getElementById('exam-timer');
        const examTitleEl = document.getElementById('exam-title');
        const rulesModal = document.getElementById('rules-modal');
        
        // Initialize the exam system
        function initExamSystem() {
            // Hide exam view by default
            examView.style.display = 'none';
            rulesModal.style.display = 'none';
        }
        
        // Show exam view
        function showExam(examId) {
            currentExam = examId;
            currentQuestionIndex = 0;
            userAnswers = Array(exams[examId].questions.length).fill(null);
            markedQuestions = Array(exams[examId].questions.length).fill(false);
            answeredCount = 0;
            timeLeft = exams[examId].duration * 60;
            
            // Update UI
            dashboardView.style.display = 'none';
            examView.style.display = 'block';
            examTitleEl.textContent = exams[examId].title;
            
            // Create question navigation buttons
            questionGrid.innerHTML = '';
            exams[examId].questions.forEach((q, index) => {
                const btn = document.createElement('button');
                btn.className = 'question-btn';
                btn.textContent = q.id;
                btn.onclick = () => navigateToQuestion(index);
                questionGrid.appendChild(btn);
            });
            
            // Show rules modal
            rulesModal.style.display = 'flex';
        }
        
        // Start the exam
        function startExam() {
            rulesModal.style.display = 'none';
            examStarted = true;
            
            // Start timer
            timerInterval = setInterval(updateTimer, 1000);
            updateTimer(); // Initial update
            
            // Load first question
            loadQuestion(currentQuestionIndex);
        }
        
        // Return to dashboard
        function returnToDashboard() {
            if (confirm('Are you sure you want to return to the dashboard? Your progress will not be saved.')) {
                clearInterval(timerInterval);
                dashboardView.style.display = 'block';
                examView.style.display = 'none';
                examStarted = false;
            }
        }
        
        // Update the timer
        function updateTimer() {
            timeLeft--;
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                submitExam();
                return;
            }
            
            const hours = Math.floor(timeLeft / 3600);
            const minutes = Math.floor((timeLeft % 3600) / 60);
            const seconds = timeLeft % 60;
            
            examTimer.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Add warning class when time is running low
            if (timeLeft <= 300) { // 5 minutes
                examTimer.classList.add('warning');
            }
        }
        
        // Navigate to a specific question
        function navigateToQuestion(index) {
            currentQuestionIndex = index;
            loadQuestion(index);
        }
        
        // Load a question
        function loadQuestion(index) {
            const exam = exams[currentExam];
            const question = exam.questions[index];
            
            // Update active question in navigation
            updateQuestionNavigation();
            
            let questionHTML = `
                <div class="question-header">
                    <div class="question-number">Question ${question.id}</div>
                    <div class="question-type">${formatQuestionType(question.type)}</div>
                </div>
                
                <div class="question-text">${question.question}</div>
            `;
            
            // Add question content based on type
            switch (question.type) {
                case 'multiple-choice':
                    questionHTML += `
                        <ul class="options-list">
                            ${question.options.map((option, i) => `
                                <li class="option-item ${userAnswers[index] === i ? 'selected' : ''}" 
                                    onclick="selectAnswer(${i})">
                                    <input type="radio" name="answer" id="option-${i}" ${userAnswers[index] === i ? 'checked' : ''}>
                                    <label for="option-${i}">${option}</label>
                                </li>
                            `).join('')}
                        </ul>
                    `;
                    break;
                    
                case 'true-false':
                    questionHTML += `
                        <div class="true-false-options">
                            <div class="true-false-btn ${userAnswers[index] === true ? 'selected' : ''}" 
                                onclick="selectAnswer(true)">
                                True
                            </div>
                            <div class="true-false-btn ${userAnswers[index] === false ? 'selected' : ''}" 
                                onclick="selectAnswer(false)">
                                False
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'matching':
                    // Improved matching question interface
                    questionHTML += `
                        <div class="matching-container">
                            <div class="matching-column">
                                <h4>Items</h4>
                                ${question.leftItems.map((item, i) => `
                                    <div class="matching-item" id="left-${i}" draggable="true" ondragstart="drag(event)">
                                        ${item}
                                    </div>
                                `).join('')}
                            </div>
                            <div class="matching-column">
                                <h4>Matches</h4>
                                ${question.rightItems.map((item, i) => `
                                    <div class="matching-item" id="right-${i}" ondrop="drop(event, ${i})" ondragover="allowDrop(event)">
                                        ${item}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                            <h4>Your Matches</h4>
                            <div class="matched-pairs-container" id="matched-pairs-container">
                                ${userAnswers[index] ? userAnswers[index].map(pair => `
                                    <div class="matched-pair" id="pair-${pair[0]}-${pair[1]}">
                                        <div class="matched-item">${question.leftItems[pair[0]]}</div>
                                        <div class="match-controls">
                                            <button class="match-btn" onclick="removeMatch(${index}, ${pair[0]}, ${pair[1]})">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                        <div class="matched-item">${question.rightItems[pair[1]]}</div>
                                    </div>
                                `).join('') : ''}
                            </div>
                        </div>
                        <div style="font-size: 14px; color: var(--text-light); margin-top: 10px;">
                            <i class="fas fa-info-circle"></i> Drag items from the left column to the right column to make matches.
                        </div>
                    `;
                    break;
                    
                case 'fill-blank':
                    questionHTML += `
                        <div class="fill-blank-container">
                            <input type="text" class="fill-blank-input" id="fill-answer" 
                                value="${userAnswers[index] || ''}" 
                                placeholder="Type your answer here" 
                                onchange="selectAnswer(this.value)">
                        </div>
                    `;
                    break;
                    
                case 'essay':
                    const essayAnswer = userAnswers[index] || '';
                    const wordCount = essayAnswer ? essayAnswer.split(/\s+/).filter(word => word.length > 0).length : 0;
                    questionHTML += `
                        <div class="essay-container">
                            <textarea class="essay-textarea" id="essay-answer" 
                                placeholder="Type your response here (minimum ${question.minWords} words)..."
                                oninput="updateEssayWordCount(${index}, this)">${essayAnswer}</textarea>
                            <div class="word-count">Words: ${wordCount} (Minimum: ${question.minWords})</div>
                        </div>
                    `;
                    break;
                    
                case 'case-study':
                    questionHTML += `
                        <div class="case-study-container">
                            <div class="case-study-text">${question.caseText}</div>
                        </div>
                        <ul class="options-list" style="margin-top: 15px;">
                            ${question.options.map((option, i) => `
                                <li class="option-item ${userAnswers[index] === i ? 'selected' : ''}" 
                                    onclick="selectAnswer(${i})">
                                    <input type="radio" name="answer" id="option-${i}" ${userAnswers[index] === i ? 'checked' : ''}>
                                    <label for="option-${i}">${option}</label>
                                </li>
                            `).join('')}
                        </ul>
                    `;
                    break;
                    
                case 'chart-radar':
                case 'chart-pie':
                case 'chart-line':
                case 'chart-bar':
                case 'chart-doughnut':
                case 'chart-polar':
                    questionHTML += `
                        <div class="chart-row">
                            <div class="chart-box">
                                <canvas id="question-chart"></canvas>
                            </div>
                        </div>
                        <ul class="options-list" style="margin-top: 15px;">
                            ${question.chartData.labels.map((label, i) => `
                                <li class="option-item ${userAnswers[index] === i ? 'selected' : ''}" 
                                    onclick="selectAnswer(${i})">
                                    <input type="radio" name="answer" id="option-${i}" ${userAnswers[index] === i ? 'checked' : ''}>
                                    <label for="option-${i}">${label}</label>
                                </li>
                            `).join('')}
                        </ul>
                    `;
                    break;
                    
                case 'calculation':
                    questionHTML += `
                        <div class="fill-blank-container">
                            <input type="text" class="fill-blank-input" id="calc-answer" 
                                value="${userAnswers[index] || ''}" 
                                placeholder="Enter your calculated answer" 
                                onchange="selectAnswer(this.value)">
                            <div style="font-size: 14px; color: var(--text-light); margin-top: 10px;">
                                <i class="fas fa-info-circle"></i> Enter numerical value only, without units.
                            </div>
                        </div>
                    `;
                    break;
            }
            
            // Add navigation buttons
            questionHTML += `
                <div class="question-actions">
                    <div>
                        ${index > 0 ? `
                            <button class="btn btn-outline" onclick="navigateToQuestion(${index - 1})">
                                <i class="fas fa-chevron-left"></i> Previous
                            </button>
                        ` : ''}
                    </div>
                    
                    <div>
                        <button class="btn mark-btn" onclick="toggleMarkQuestion()">
                            ${markedQuestions[index] ? '<i class="fas fa-flag"></i> Unmark' : '<i class="far fa-flag"></i> Mark'}
                        </button>
                        
                        ${index < exams[currentExam].questions.length - 1 ? `
                            <button class="btn btn-primary" onclick="navigateToQuestion(${index + 1})">
                                Next <i class="fas fa-chevron-right"></i>
                            </button>
                        ` : `
                            <button class="btn submit-btn" onclick="confirmSubmit()">
                                <i class="fas fa-paper-plane"></i> Submit Exam
                            </button>
                        `}
                    </div>
                </div>
            `;
            
            questionContent.innerHTML = questionHTML;
            
            // Render chart if this is a chart question
            if (question.type.includes('chart')) {
                renderChart(question.type, question.chartData);
            }
        }
        
        // Format question type for display
        function formatQuestionType(type) {
            const typeMap = {
                'multiple-choice': 'Multiple Choice',
                'true-false': 'True/False',
                'matching': 'Matching',
                'fill-blank': 'Fill in the Blank',
                'essay': 'Essay',
                'case-study': 'Case Study',
                'chart-radar': 'Radar Chart',
                'chart-pie': 'Pie Chart',
                'chart-line': 'Line Chart',
                'chart-bar': 'Bar Chart',
                'chart-doughnut': 'Doughnut Chart',
                'chart-polar': 'Polar Chart',
                'calculation': 'Calculation'
            };
            return typeMap[type] || type;
        }
        
        // Render chart for chart questions
        function renderChart(chartType, chartData) {
            // Destroy previous charts
            charts.forEach(chart => chart.destroy());
            charts = [];
            
            const ctx = document.getElementById('question-chart').getContext('2d');
            let newChart;
            
            const chartTypeMap = {
                'chart-radar': 'radar',
                'chart-pie': 'pie',
                'chart-line': 'line',
                'chart-bar': 'bar',
                'chart-doughnut': 'doughnut',
                'chart-polar': 'polarArea'
            };
            
            newChart = new Chart(ctx, {
                type: chartTypeMap[chartType],
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                font: {
                                    size: 10
                                }
                            }
                        }
                    },
                    scales: chartType === 'chart-radar' ? {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            pointLabels: {
                                font: {
                                    size: 10
                                }
                            }
                        }
                    } : {}
                }
            });
            
            charts.push(newChart);
        }
        
        // Update question navigation buttons
        function updateQuestionNavigation() {
            const buttons = questionGrid.querySelectorAll('.question-btn');
            const exam = exams[currentExam];
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'answered', 'marked');
                
                if (index === currentQuestionIndex) {
                    btn.classList.add('active');
                }
                
                if (userAnswers[index] !== null) {
                    btn.classList.add('answered');
                }
                
                if (markedQuestions[index]) {
                    btn.classList.add('marked');
                }
            });
            
            // Update answered count
            answeredCount = userAnswers.filter(answer => answer !== null).length;
            answeredCountEl.textContent = `${answeredCount}/${exam.questions.length}`;
        }
        
        // Select an answer
        function selectAnswer(answer) {
            userAnswers[currentQuestionIndex] = answer;
            updateQuestionNavigation();
            
            // For fill-blank and essay questions, we need to reload to update the selected state
            const question = exams[currentExam].questions[currentQuestionIndex];
            if (question.type === 'fill-blank' || question.type === 'essay' || question.type === 'calculation') {
                loadQuestion(currentQuestionIndex);
            }
        }
        
        // Update essay word count
        function updateEssayWordCount(index, textarea) {
            const answer = textarea.value;
            userAnswers[index] = answer;
            
            const wordCount = answer ? answer.split(/\s+/).filter(word => word.length > 0).length : 0;
            const wordCountEl = textarea.nextElementSibling;
            wordCountEl.textContent = `Words: ${wordCount} (Minimum: ${exams[currentExam].questions[index].minWords})`;
            
            updateQuestionNavigation();
        }
        
        // Toggle mark question
        function toggleMarkQuestion() {
            markedQuestions[currentQuestionIndex] = !markedQuestions[currentQuestionIndex];
            updateQuestionNavigation();
            loadQuestion(currentQuestionIndex); // Reload to update mark button text
        }
        
        // Drag and drop functions for matching questions
        function allowDrop(ev) {
            ev.preventDefault();
        }
        
        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }
        
        function drop(ev, rightIndex) {
            ev.preventDefault();
            const leftId = ev.dataTransfer.getData("text");
            const leftIndex = parseInt(leftId.split('-')[1]);
            
            // Get the question
            const question = exams[currentExam].questions[currentQuestionIndex];
            
            // Initialize user answer if not already done
            if (!userAnswers[currentQuestionIndex]) {
                userAnswers[currentQuestionIndex] = [];
            }
            
            // Check if this left item is already matched
            const existingMatchIndex = userAnswers[currentQuestionIndex].findIndex(pair => pair[0] === leftIndex);
            
            if (existingMatchIndex >= 0) {
                // Remove existing match
                userAnswers[currentQuestionIndex].splice(existingMatchIndex, 1);
            }
            
            // Add new match
            userAnswers[currentQuestionIndex].push([leftIndex, rightIndex]);
            
            // Update the display
            loadQuestion(currentQuestionIndex);
        }
        
        // Remove a match
        function removeMatch(questionIndex, leftIndex, rightIndex) {
            const matchIndex = userAnswers[questionIndex].findIndex(
                pair => pair[0] === leftIndex && pair[1] === rightIndex
            );
            
            if (matchIndex >= 0) {
                userAnswers[questionIndex].splice(matchIndex, 1);
                loadQuestion(questionIndex);
            }
        }
        
        // Confirm before submitting exam
        function confirmSubmit() {
            const unanswered = userAnswers.filter(answer => answer === null).length;
            
            if (unanswered > 0) {
                if (!confirm(`You have ${unanswered} unanswered questions. Are you sure you want to submit?`)) {
                    return;
                }
            } else {
                if (!confirm('Are you sure you want to submit your exam?')) {
                    return;
                }
            }
            
            submitExam();
        }
        
        // Submit the exam
        function submitExam() {
            clearInterval(timerInterval);
            examStarted = false;
            
            // Calculate score
            let correctAnswers = 0;
            const exam = exams[currentExam];
            
            exam.questions.forEach((question, index) => {
                if (question.type === 'fill-blank' || question.type === 'calculation') {
                    if (userAnswers[index] && userAnswers[index].toString().toLowerCase() === question.correctAnswer.toLowerCase()) {
                        correctAnswers++;
                    }
                } else if (question.type === 'essay') {
                    // For essay questions, we'll just count them as answered
                    if (userAnswers[index]) {
                        correctAnswers++;
                    }
                } else if (question.type === 'matching') {
                    // For matching questions, check if all correct matches are present
                    if (userAnswers[index] && userAnswers[index].length === question.correctMatches.length) {
                        const allCorrect = question.correctMatches.every(correctPair => 
                            userAnswers[index].some(userPair => 
                                userPair[0] === correctPair[0] && userPair[1] === correctPair[1]
                            )
                        );
                        if (allCorrect) {
                            correctAnswers++;
                        }
                    }
                } else {
                    if (userAnswers[index] === question.correctAnswer) {
                        correctAnswers++;
                    }
                }
            });
            
            const score = Math.round((correctAnswers / exam.questions.length) * 100);
            
            // Show results
            questionContent.innerHTML = `
                <div style="text-align: center; padding: 30px 15px;">
                    <h2 style="color: var(--primary-color); margin-bottom: 15px;">Exam Submitted Successfully</h2>
                    <div style="font-size: 48px; color: var(--secondary-color); font-weight: bold; margin: 20px 0;">${score}%</div>
                    <p style="font-size: 16px; margin-bottom: 20px;">
                        You answered ${correctAnswers} out of ${exam.questions.length} questions correctly.
                    </p>
                    
                    <div class="result-chart-container">
                        <canvas id="result-chart"></canvas>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 10px;">
                        <button class="btn btn-primary" onclick="reviewExam()">
                            <i class="fas fa-search"></i> Review Answers
                        </button>
                        <button class="btn btn-outline" onclick="returnToDashboard()">
                            <i class="fas fa-home"></i> Return to Dashboard
                        </button>
                    </div>
                </div>
            `;
            
            // Show result chart
            const ctx = document.getElementById('result-chart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Correct', 'Incorrect', 'Unanswered'],
                    datasets: [{
                        data: [
                            correctAnswers,
                            userAnswers.filter(a => a !== null).length - correctAnswers,
                            userAnswers.filter(a => a === null).length
                        ],
                        backgroundColor: [
                            'rgba(76, 175, 80, 0.7)',
                            'rgba(244, 67, 54, 0.7)',
                            'rgba(158, 158, 158, 0.7)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                font: {
                                    size: 10
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Review exam answers
        function reviewExam() {
            currentQuestionIndex = 0;
            loadQuestion(currentQuestionIndex);
        }
        
        // Initialize the system when page loads
        window.onload = initExamSystem;
    </script>
</body>
</html>