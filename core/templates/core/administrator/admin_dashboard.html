{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | CHIETA</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="{% static 'core/css/dashboard.css' %}">
</head>
<style>
  .content {
    background-color: #efeaea;
    background-image: url("{% static 'core/images/Frame.png' %}");
    background-repeat: no-repeat;
    background-size: cover;
    opacity: 0.9;
  }

  .sidebar ul {
    list-style-type: none;
    padding-left: 0;
    /* removes default padding */
  }

  .sidebar li {
    margin-bottom: 10px;
    /* optional spacing between items */
  }

  .logout-btn {
    /* display: block; */
    /* width: 100%; */
    padding: 7px 7px;
    margin-top: 10px;
    font-size: 14px;
    background-color: #630671;
    color: white;
    text-align: left;
    border-radius: 6px;
    text-decoration: none;
    transition: background-color 0.3s ease;
  }

  .overal_container{
    background-color: rgb(255, 255, 255);
  }

  /* .logout-btn:hover {
    background-color: #c82333;
    text-decoration: none;
    color: #fff;
  } */
</style>

<body>
  <div class="overal_container">
    <div class="dashboard-container">
      <div class="sidebar">
  <div class="sidebar-header">
    <div class="graduate-icon">
      <img src="{% static 'core/images/logo_simplebbbbbbbbbbbbbb.png' %}" alt="CHIETA Logo" style="width: 130px;">
    </div>
  </div>
  
  <nav class="sidebar-nav">
    <ul class="nav-list">
     
      
      <li class="nav-item">
        <a href="{% url 'admin_dashboard' %}" class="nav-link{% if request.resolver_match.url_name == 'admin_dashboard' %} active{% endif %}">
          <i class="fa fa-home"></i>
          <span>Dashboard</span>
        </a>
      </li>

       <li class="nav-item">
        <a class="nav-link{% if request.resolver_match.url_name == 'upload_assessment' %} active{% endif %}" 
           href="{% url 'upload_assessment' %}">
          <i class="fa fa-upload"></i>
          <span>Upload Assessment</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a href="{% url 'assessment_centres' %}" class="nav-link{% if request.resolver_match.url_name == 'assessment_centres' %} active{% endif %}">
          <i class="fa fa-upload"></i>
          <span>Assessment Centres</span>
        </a>
      </li>

          <li class="nav-item">
        <a href="{% url 'review_saved_selector' %}" class="nav-link{% if request.resolver_match.url_name == 'review_saved_selector' %} active{% endif %}">
            <i class="fa fa-book"></i>
            <span>Question Bank</span>
        </a>
    </li>
      
      <li class="nav-item">
        <a href="{% url 'user_management' %}" class="nav-link{% if request.resolver_match.url_name == 'user_management' %} active{% endif %}">
          <i class="fa fa-cogs"></i>
          <span>User Management</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a href="{% url 'manage_qualifications' %}" class="nav-link{% if request.resolver_match.url_name == 'manage_qualifications' %} active{% endif %}">
          <i class="fa fa-cogs"></i>
          <span>Qualifications</span>
        </a>
      </li>
    </ul>
    
    <div class="sidebar-footer">
      <a href="{% url 'logout' %}" class="logout-btn">
        <i class="fa fa-sign-out"></i>
        <span>Log Out</span>
      </a>
      <img src="{% static 'core/images/rb_2149331949.png' %}" alt="Sidebar Art" class="sidebar-art">
    </div>
  </nav>
</div>

      <div class="content p-4">
        <div class="welcome-container">
          <div class="image-container">
            <!-- <img src="{% static 'core/images/rb_2148892786.png' %}" alt="Profile Picture" width="390px" height="190px"> -->
          </div>
          <div class="welcome-box">
            <h2>Administrator Dashboard</h2>
            <div class="date">Archived Assessments</div>
            <button class="gradient-button">Innovating for Impact</button>
          </div>
        </div>

        <div class="row mb-4">
          <div class="col-md-4">
            <div class="card text-center">
              <div class="card-body">
                <h5 class="card-title">Databank</h5>
                <a href="{% url 'databank' %}" class="btn btn-outline-primary btn-sm">View</a>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card text-center">
              <div class="card-body">
                <h5 class="card-title">Assessment Centres</h5>
                <a href="{% url 'assessment_centres' %}" class="btn btn-outline-primary btn-sm">View</a>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card text-center">
              <div class="card-body">
                <h5 class="card-title">Total Registered Users</h5>
                <p class="card-text">{{ total_users }}</p>
              </div>
            </div>
          </div>
        </div>

<!-- ========= Upload Assessment Form ========= -->
<div class="card mb-4">
  <div class="card-header">Upload New Assessment</div>
  <div class="card-body">
    <form method="post" enctype="multipart/form-data" class="row g-3" id="uploadForm">
      {% csrf_token %}

      <!-- Qualification Dropdown -->
      <div class="col-md-4">
        <label for="qual" class="form-label">Qualification</label>
        <select id="qual" name="qualification" class="form-select form-select-sm" required>

          <option value="">— Select Qualification —</option>
          {% for q in qualifications %}
            <option value="{{ q.id }}" data-name="{{ q.name }}" data-saqa="{{ q.saqa_id }}">
              {{ q.name }}
            </option>
          {% endfor %}
        </select>
      </div>




      <!-- Auto-filled SAQA ID -->
      <div class="col-md-3">
        <label for="saqa" class="form-label">SAQA ID</label>
        <input type="text" id="saqa" name="saqa_id"
               class="form-control form-control-sm"
               placeholder="Auto-filled" readonly>
      </div>

      <!-- Assessment File -->
      <div class="col-md-6">
        <label for="file" class="form-label">Assessment File</label>
        <input type="file" id="file" name="file_input"
               class="form-control form-control-sm"
               accept=".docx,.pdf" required>
        <small class="text-muted">Upload DOCX or PDF file</small>
      </div>

      <!-- Memo File -->
      <div class="col-md-6">
        <label for="memo" class="form-label">Memo File (Required)</label>
        <input type="file" id="memo" name="memo_file"
               class="form-control form-control-sm"
               accept=".docx,.pdf" required>
        <small class="text-muted">Upload assessment memo</small>
      </div>

      <div class="col-12 text-end">
        <button type="submit" class="btn btn-primary btn-sm">Upload Assessment</button>
      </div>
    </form>
  </div>
</div>

<!-- ========= List of Uploaded Assessments ========= -->
<div class="card mb-4">
  <div class="card-header">Assessment Tool Management</div>
  <div class="card-body">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Qualification</th>
          <th>Paper</th>
          <th>Status</th>
          <th>Uploaded By</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for tool in tools %}
        <tr>
          <td>{{ tool.qualification.name }}</td>
          <td>{{ tool.paper }}</td>
          <td>{{ tool.status }}</td>
          <td>
            {% if tool.created_by %}
              {{ tool.created_by.get_full_name|default:tool.created_by.email }}
            {% else %}
              &mdash;
            {% endif %}
          </td>
          <td>
            {% if tool.file %}
              <a href="{{ tool.file.url }}" target="_blank">Download</a>
            {% else %}
              &mdash;
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center">No assessments uploaded yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- ========= JavaScript for Auto-fill & Validation ========= -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const qualSelect = document.getElementById("qual");
    const saqaInput = document.getElementById("saqa");
    const moduleNumber = document.getElementById("moduleNumber");
    const moduleName = document.getElementById("moduleName");

    if (qualSelect && saqaInput) {
      qualSelect.addEventListener("change", () => {
        const selected = qualSelect.options[qualSelect.selectedIndex];
        saqaInput.value = selected.getAttribute("data-saqa") || "";
      });
    }

    if (moduleNumber && moduleName) {
      moduleNumber.addEventListener("change", () => {
        const text = moduleNumber.options[moduleNumber.selectedIndex].text;
        moduleName.value = text.replace('Module ', '');
      });
    }

    document.getElementById('uploadForm').addEventListener('submit', function (e) {
      if (!document.getElementById('memo').files[0]) {
        e.preventDefault();
        alert('Please upload a memo file - this is required.');
      }
    });
  });
</script>
