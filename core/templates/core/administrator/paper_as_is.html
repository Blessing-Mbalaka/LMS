{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<h2>Review Paper "As-Is"</h2>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="file" name="paper" class="form-control mb-3" accept=".docx">
    <button type="submit" class="btn btn-primary">Upload & Preview</button>
</form>

{% if blocks %}
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="mt-4">
      {% for block in blocks %}
        <div class="block mb-4 p-3 border">
          <div class="mb-2 d-flex align-items-center">
            <label class="me-2">Type:</label>
            <select name="type_{{ forloop.counter }}" class="form-select w-auto">
              <option value="question_header" {% if block.type == "question_header" %}selected{% endif %}>Question Header</option>
              <option value="case_study" {% if block.type == "case_study" %}selected{% endif %}>Case Study</option>
              <option value="paragraph" {% if block.type == "paragraph" %}selected{% endif %}>Paragraph</option>
              <option value="table" {% if block.type == "table" %}selected{% endif %}>Table</option>
            </select>
          </div>

          {% if block.type == "question_header" or block.type == "paragraph" or block.type == "case_study" %}
            <textarea name="text_{{ forloop.counter }}" class="form-control" rows="3">{{ block.text }}</textarea>
          {% elif block.type == "table" %}
            <div class="table-responsive">
              <table class="table table-bordered">
                {% for row in block.rows %}
                  <tr>
                    {% for cell in row %}
                      <td>{{ cell }}</td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              </table>
            </div>
            <input type="hidden" name="rows_{{ forloop.counter }}" value="{{ block.rows|escapejs }}">
          {% endif %}
        </div>
      {% endfor %}
    </div>
    <button type="submit" class="btn btn-success">Save Manual Edits</button>
  </form>
{% endif %}
{% endblock %}
