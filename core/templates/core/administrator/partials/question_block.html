{# core/templates/core/administrator/partials/question_block.html #}
{% load uuid_extras %}

<div class="block card mb-3" 
     data-id="{{ q.id }}" 
     data-type="{{ q.type }}" 
     data-qn="{{ q.number }}"
     data-marks="{{ q.marks }}">
  
  <div class="card-header d-flex justify-content-between align-items-center">
    <div>
      <span class="badge bg-secondary type-badge">{{ q.type }}</span>
      {% if q.number %}<strong>Q{{ q.number }}</strong>{% endif %}
      {% if q.marks %}<span class="badge bg-success ms-2">{{ q.marks }} marks</span>{% endif %}
    </div>
    <div class="btn-group btn-group-sm">
      <button type="button" class="btn btn-outline-danger delete-block-btn">Delete</button>
    </div>
  </div>
  
  <div class="card-body">
    {% if q.text %}
      <div class="mb-3">
        <textarea class="form-control block-text" rows="3">{{ q.text }}</textarea>
      </div>
    {% endif %}
    
    <!-- Render table content properly -->
    {% for item in q.content %}
      {% if item.type == 'table' and item.rows %}
        <div class="table-responsive mt-3 block-content">
          <table class="table table-bordered table-sm">
            {% for row in item.rows %}
              <tr>
                {% for cell in row %}
                  <td>{{ cell }}</td>
                {% endfor %}
              </tr>
            {% endfor %}
          </table>
        </div>
      {% endif %}
      
      <!-- Render figure/image content -->
      {% if item.type == 'figure' and item.images %}
        <div class="mt-3 block-content">
          {% for img in item.images %}
            <img src="/media/exam_images/{{ img }}" class="img-fluid mb-2" alt="Question image">
          {% endfor %}
        </div>
      {% endif %}
    {% endfor %}
  </div>

  {# Recursive rendering of children handled in parent #}
  {% if q.children %}
    <div class="children ms-4 mt-2">
      {% for child in q.children %}
        {% include "core/administrator/partials/question_block.html" with q=child %}
      {% endfor %}
    </div>
  {% endif %}
</div>
